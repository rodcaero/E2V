---
import Layout from '../layouts/Layout.astro';

// 1. Definimos la estructura de los Markdown
interface Frontmatter {
  title: string;
  description: string;
  date: string;
  category: string;
  image: string;
  slug: string;
}

// Configuración del Banner de Avisos
const banner = {
  active: true,
  message: '¡Nuevas ubicaciones de ElectroPoint disponibles! Conoce más.',
  link: '/',
  type: 'info' 
};

// Contenido del Hero
const heroContent = {
  title: 'ENERGÍA QUE IMPULSA TU FUTURO',
  subtitle: 'Soluciones eléctricas de vanguardia y puntos de carga inteligentes con el respaldo de E2V.',
  ctaText: 'Descubre ElectroPoint',
  ctaLink: '/',
  image: '/hero-e2v.webp' 
};

// 2. Traemos TODAS las noticias reales desde los archivos Markdown
const allNews = await Astro.glob<Frontmatter>('../data/noticias/*.md');

// 3. Las ordenamos de la más reciente a la más antigua
const sortedNews = allNews.sort((a, b) => new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf());

// 4. Tomamos SOLO las últimas 3 noticias para mostrar en el inicio
const recentNews = sortedNews.slice(0, 3);
---

<Layout title="E2V - Ingeniería Eléctrica Avanzada">
  <main>
    
    {banner.active && (
      <div id="top-banner" class={`top-banner ${banner.type}`}>
        <div class="banner-container">
          <p>{banner.message}</p>
          <a href={banner.link} class="banner-link">Ver más &rarr;</a>
        </div>
      </div>
    )}

    <section id="inicio" class="section hero">
      <div class="hero-container">
        <div class="hero-content fade-in">
          <span class="eyebrow">Ingeniería & Tecnología</span>
          <h1>{heroContent.title}</h1>
          <p>{heroContent.subtitle}</p>
          <a href={heroContent.ctaLink} class="btn-primary-hero">{heroContent.ctaText}</a>
        </div>
        <div class="hero-image-wrapper fade-in delay-1">
          <img src={heroContent.image} alt="E2V Energía Inteligente" class="hero-image" onerror="this.src='https://images.unsplash.com/photo-1466611653911-95081537e5b7?auto=format&fit=crop&w=1000&q=80'" />
        </div>
      </div>
    </section>

    <section class="section-integrated">
      <div class="container">
        <div class="integrated-grid">
          
          <div class="about-col fade-in delay-1">
            <div class="section-header-clean">
              <span class="eyebrow">Nuestra Identidad</span>
              <h2>Ingeniería que transforma</h2>
              <p class="main-description">
                En <strong>E2V</strong>, combinamos experiencia técnica con innovación para ofrecer soluciones eléctricas que impulsan el desarrollo industrial y urbano en Bolivia.
              </p>
            </div>
            
            <div class="mision-vision-clean">
              <div class="mv-row">
                <div class="mv-icon-clean">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/><path d="m9 12 2 2 4-4"/></svg>
                </div>
                <div class="mv-text">
                  <h3>Misión</h3>
                  <p>Desarrollar soluciones energéticas innovadoras, competitivas y sostenibles.</p>
                </div>
              </div>
              <div class="mv-row">
                <div class="mv-icon-clean">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="1"/></svg>
                </div>
                <div class="mv-text">
                  <h3>Visión</h3>
                  <p>Ser el referente nacional en infraestructura energética renovable y eficiente.</p>
                </div>
              </div>
            </div>

            <div class="about-image-clean">
              <img src="https://images.unsplash.com/photo-1581094794329-c8112a89af12?auto=format&fit=crop&q=80&w=800" alt="Ingeniería E2V" />
              <div class="experience-badge-clean">
                <span class="number">10+</span>
                <span class="text">Años de<br/>Experiencia</span>
              </div>
            </div>
          </div>

          <div class="news-col fade-in delay-2">
            <div class="header-top-right">
              <span class="eyebrow">Avisos y Noticias Recientes</span>
              <a href="/noticias" class="view-all-link">Ver todas &rarr;</a>
            </div>

            <div class="news-list-clean">
              {recentNews.map((item) => (
                <a href={`/noticias/${item.frontmatter.slug}`} class="news-row">
                  <div class="news-thumb-clean">
                    <img src={item.frontmatter.image} alt={item.frontmatter.title} />
                  </div>
                  <div class="news-info-clean">
                    <span class="news-date-clean">{item.frontmatter.date}</span>
                    <h4>{item.frontmatter.title}</h4>
                  </div>
                </a>
              ))}
            </div>

            <div class="promo-block">
              <div class="promo-content">
                <h4>Asesoría Técnica Especializada</h4>
                <p>Descubre cómo optimizar el consumo eléctrico de tu empresa.</p>
              </div>
              <a href="/contacto" class="btn-promo">Solicitar Asesoría</a>
            </div>
          </div>

        </div>
      </div>
    </section>

    <section id="contacto" class="section-cta-full fade-in delay-3">
      <div class="container cta-flex">
        
        <div class="cta-text-side">
          <h2>¿Listo para empezar tu proyecto?</h2>
          <p>Comunícate por tu canal preferido o envíanos los detalles a través de nuestro formulario en línea.</p>
          
          <div class="cta-channels">
            <a href="https://wa.me/591XXXXXXX" target="_blank" class="channel-pill">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
              <span>+591 XXXXXXXX</span>
            </a>
            <a href="mailto:info@e2v.bo" class="channel-pill">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
              <span>info@e2v.bo</span>
            </a>
          </div>
        </div>

        <div class="cta-action-side">
           <a href="/contacto" class="btn-cta-giant">
             Ir al Formulario
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
           </a>
        </div>

      </div>
    </section>

  </main>
</Layout>

<style>
  /* --- GLOBALES --- */
  .container { max-width: var(--content-max-width, 1200px); margin: 0 auto; padding: 0 1.5rem; }
  :root { --radius-sm: 6px; --radius-md: 12px; }

  /* Eyebrow */
  .eyebrow { 
    color: var(--cta-dark); background-color: var(--cta-main); 
    padding: 0.3rem 0.8rem; font-weight: 700; font-size: 0.7rem; text-transform: uppercase; 
    letter-spacing: 0.05em; display: inline-block; margin-bottom: 0.8rem;
    border-radius: var(--radius-sm);
  }

  /* --- BANNER --- */
  .top-banner { background-color: var(--brand-800); color: var(--brand-200); padding: 8px 0; font-size: 0.8rem; height: 38px; box-sizing: border-box; }
  .banner-container { display: flex; justify-content: center; align-items: center; gap: 15px; width: 90%; margin: auto; height: 100%;}
  .banner-link { color: var(--cta-main); text-decoration: none; font-weight: 700; transition: color 0.2s; }
  .banner-link:hover { color: var(--white); }

  /* --- HERO SECTION --- */
  .hero { background: var(--brand-100); min-height: calc(100vh - 118px); display: flex; align-items: center; padding: 2rem 0; }
  .hero-container { display: grid; grid-template-columns: 1.1fr 0.9fr; width: 90%; max-width: 1200px; margin: 0 auto; align-items: center; gap: 4rem; }
  
  .hero-content h1 { font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 800; line-height: 1.05; margin-bottom: 1rem; color: var(--brand-800); }
  .hero-content p { font-size: 1.1rem; margin-bottom: 2rem; color: var(--brand-600); line-height: 1.5; max-width: 90%; }
  
  .btn-primary-hero { display: inline-flex; align-items: center; justify-content: center; background-color: var(--cta-main); color: var(--brand-800); padding: 1rem 2rem; font-weight: 700; text-transform: uppercase; text-decoration: none; transition: all 0.2s ease; border-radius: var(--radius-sm); letter-spacing: 0.02em; }
  .btn-primary-hero:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(254, 183, 64, 0.25); }

  .hero-image-wrapper { height: 440px; border-radius: var(--radius-md); overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.06); border: 1px solid var(--white); }
  .hero-image { width: 100%; height: 100%; object-fit: cover; }

  /* --- SECCIÓN INTEGRADA EDITORIAL --- */
  .section-integrated { padding: 6rem 0; background-color: var(--white); }
  .integrated-grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 4rem; align-items: stretch; }

  /* Columna Izquierda (About) */
  .about-col { display: flex; flex-direction: column; border-right: 1px solid var(--brand-200); padding-right: 4rem; }
  .section-header-clean h2 { font-size: 2.2rem; color: var(--brand-800); margin-bottom: 1.2rem; line-height: 1.1; }
  .main-description { font-size: 1.1rem; line-height: 1.6; color: var(--brand-600); margin-bottom: 2.5rem; }
  
  .mision-vision-clean { display: flex; flex-direction: column; gap: 1.8rem; margin-bottom: 3rem; }
  .mv-row { display: flex; gap: 1.2rem; align-items: flex-start; }
  .mv-icon-clean { color: var(--cta-main); width: 32px; height: 32px; display: flex; align-items: center; justify-content: flex-start; flex-shrink: 0; }
  .mv-text h3 { font-size: 1.05rem; margin-bottom: 0.3rem; color: var(--brand-800); }
  .mv-text p { color: var(--brand-600); font-size: 0.95rem; line-height: 1.5; margin: 0; }

  .about-image-clean { position: relative; height: 180px; border-radius: var(--radius-md); overflow: hidden; margin-top: auto; }
  .about-image-clean img { width: 100%; height: 100%; object-fit: cover; }
  .experience-badge-clean { position: absolute; bottom: 0; left: 0; background: var(--white); color: var(--brand-800); padding: 0.8rem 1.5rem; display: flex; align-items: center; gap: 0.8rem; border-top-right-radius: var(--radius-md); border-top: 1px solid var(--brand-200); border-right: 1px solid var(--brand-200); }
  .experience-badge-clean .number { font-size: 2rem; font-weight: 800; color: var(--cta-main); line-height: 1; }
  .experience-badge-clean .text { font-size: 0.75rem; text-transform: uppercase; font-weight: 700; line-height: 1.2; letter-spacing: 0.05em; }

  /* Columna Derecha (Noticias) */
  .news-col { display: flex; flex-direction: column; }
  .header-top-right { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; border-bottom: 1px solid var(--brand-200); padding-bottom: 1rem;}
  .view-all-link { font-size: 0.85rem; font-weight: 700; color: var(--brand-600); text-decoration: none; text-transform: uppercase; transition: color 0.2s; }
  .view-all-link:hover { color: var(--cta-main); }

  /* Enlaces de Noticias Limpios */
  .news-list-clean { display: flex; flex-direction: column; flex: 1; }
  
  /* IMPORTANTE: Ahora la fila es un enlace (a) */
  .news-row { 
    display: flex; gap: 1.2rem; padding: 1.5rem 0; 
    border-bottom: 1px solid var(--brand-200); 
    transition: all 0.2s; cursor: pointer; 
    text-decoration: none; color: inherit; /* Resetea el estilo base del enlace */
  }
  .news-row:hover { transform: translateX(5px); }
  .news-row:hover .news-info-clean h4 { color: var(--cta-main); }
  
  .news-thumb-clean { width: 80px; height: 80px; border-radius: var(--radius-sm); overflow: hidden; flex-shrink: 0; }
  .news-thumb-clean img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
  .news-row:hover .news-thumb-clean img { transform: scale(1.05); }
  
  .news-info-clean { display: flex; flex-direction: column; justify-content: center; }
  .news-date-clean { font-size: 0.75rem; color: var(--brand-400); text-transform: uppercase; font-weight: 700; margin-bottom: 0.4rem; letter-spacing: 0.05em; }
  .news-info-clean h4 { font-size: 1rem; line-height: 1.4; color: var(--brand-800); margin: 0; font-weight: 600; transition: color 0.2s;}

  /* Bloque Promocional */
  .promo-block { margin-top: 2rem; background: var(--brand-100); padding: 2rem; border-radius: var(--radius-md); border-left: 4px solid var(--cta-main); display: flex; flex-direction: column; gap: 1rem; }
  .promo-content h4 { color: var(--brand-800); font-size: 1.1rem; margin-bottom: 0.3rem; }
  .promo-content p { font-size: 0.9rem; color: var(--brand-600); margin-bottom: 0; line-height: 1.5; }
  .btn-promo { display: inline-flex; font-weight: 700; text-transform: uppercase; color: var(--brand-800); font-size: 0.8rem; text-decoration: none; align-self: flex-start; border-bottom: 2px solid var(--cta-main); padding-bottom: 2px; transition: all 0.2s; }
  .btn-promo:hover { color: var(--cta-main); }

  /* --- CTA CONTACTO --- */
  .section-cta-full { background: var(--brand-800); color: var(--white); padding: 5rem 0; border-top: 4px solid var(--cta-main); }
  .cta-flex { display: flex; justify-content: space-between; align-items: center; gap: 3rem; }
  
  .cta-text-side { flex: 1; }
  .cta-text-side h2 { font-size: 2.2rem; margin-bottom: 0.8rem; line-height: 1.1; }
  .cta-text-side p { color: var(--brand-200); font-size: 1.05rem; line-height: 1.5; margin-bottom: 1.5rem; max-width: 600px; }

  .cta-channels { display: flex; gap: 1rem; flex-wrap: wrap; }
  .channel-pill { display: flex; align-items: center; gap: 0.6rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 0.6rem 1.2rem; border-radius: 50px; color: var(--white); text-decoration: none; transition: all 0.2s; }
  .channel-pill:hover { background: rgba(255,255,255,0.1); border-color: var(--cta-main); transform: translateY(-2px); }
  .channel-pill svg { color: var(--cta-main); width: 18px; height: 18px; }
  .channel-pill span { font-weight: 500; font-size: 0.9rem; }

  .cta-action-side { flex: 0.8; display: flex; justify-content: flex-end; }
  .btn-cta-giant { background: var(--cta-main); color: var(--brand-800); padding: 1.2rem 2.2rem; font-weight: 800; font-size: 1rem; text-transform: uppercase; text-decoration: none; border-radius: var(--radius-sm); transition: transform 0.2s; display: flex; align-items: center; gap: 1rem; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
  .btn-cta-giant:hover { transform: translateY(-4px); background: var(--white); box-shadow: 0 15px 30px rgba(0,0,0,0.3); }

  /* --- ANIMACIONES --- */
  .fade-in { opacity: 0; animation: fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
  .delay-1 { animation-delay: 0.1s; }
  .delay-2 { animation-delay: 0.2s; }
  .delay-3 { animation-delay: 0.3s; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

  /* --- RESPONSIVE --- */
  @media (max-width: 1024px) {
    .cta-flex { flex-direction: column; align-items: flex-start; text-align: left; gap: 2rem; }
    .cta-action-side { justify-content: flex-start; width: 100%; }
    .btn-cta-giant { width: 100%; justify-content: center; }
  }

  @media (max-width: 900px) {
    .hero { min-height: auto; padding: 3rem 0; }
    .hero-container { grid-template-columns: 1fr; text-align: center; gap: 2.5rem; }
    .hero-content p { margin: 0 auto 2rem; }
    .hero-image-wrapper { height: 300px; }
    
    .integrated-grid { grid-template-columns: 1fr; gap: 4rem; }
    .about-col { border-right: none; padding-right: 0; }
    
    .cta-channels { flex-direction: column; width: 100%; }
    .channel-pill { justify-content: center; }
  }
</style>