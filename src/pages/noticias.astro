---
import Layout from '../layouts/Layout.astro';

// 1. Le decimos a TypeScript qué datos esperar de los Markdown
interface Frontmatter {
  title: string;
  description: string;
  date: string;
  category: string;
  image: string;
  slug: string;
  meta_title: string;
  meta_description: string;
}

// 2. Traemos todas las noticias
const allNews = await Astro.glob<Frontmatter>('../data/noticias/*.md');

// 3. Las ordenamos por fecha (la más nueva primero)
const sortedNews = allNews.sort((a, b) => new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf());

const featuredNews = sortedNews[0];
const secondaryNews = sortedNews.slice(1);
---

<Layout title="Noticias | E2V Bolivia">
  <main class="news-page">
    
    <section class="news-header">
      <div class="container">
        <div class="header-text">
          <span class="eyebrow fade-in">Actualidad Nacional</span>
          <h1 class="fade-in delay-1">Monitor de Noticias</h1>
          <p class="subtitle fade-in delay-2">Inteligencia de mercado sobre la transición energética en Bolivia.</p>
        </div>
      </div>
    </section>

    <section class="news-content">
      <div class="container">
        
        {featuredNews && (
          <article class="featured-card fade-in delay-3">
            <div class="feat-image-wrap">
              <img src={featuredNews.frontmatter.image} alt={featuredNews.frontmatter.title} />
              <span class="category-tag">{featuredNews.frontmatter.category}</span>
            </div>
            <div class="feat-content">
              <span class="date">{featuredNews.frontmatter.date}</span>
              <h2>{featuredNews.frontmatter.title}</h2>
              <p>{featuredNews.frontmatter.description}</p>
              <a href={`/noticias/${featuredNews.frontmatter.slug}`} class="read-btn">
                Conoce los detalles aquí &rarr;
              </a>
            </div>
          </article>
        )}

        <div class="news-grid">
          {secondaryNews.map((news, index) => (
            <article class="news-card fade-in" style={`animation-delay: ${0.6 + (index * 0.15)}s;`}>
              <div class="card-image-wrap">
                <img src={news.frontmatter.image} alt={news.frontmatter.title} />
                <span class="category-tag-sm">{news.frontmatter.category}</span>
              </div>
              <div class="card-content">
                <span class="date-sm">{news.frontmatter.date}</span>
                <h3>{news.frontmatter.title}</h3>
                <a href={`/noticias/${news.frontmatter.slug}`} class="read-link">
                  Conoce los detalles aquí
                </a>
              </div>
            </article>
          ))}
        </div>

      </div>
    </section>

  </main>
</Layout>

<style>
  /* --- BASE --- */
  .news-page { background-color: var(--brand-100, #f7fafc); min-height: 100vh; padding-bottom: 5rem; }
  .container { max-width: var(--content-max-width, 1200px); margin: 0 auto; padding: 0 1.5rem; }

  /* --- HEADER --- */
  .news-header { background-color: var(--brand-800, #1a202c); padding: 4rem 0; color: white; border-bottom: 4px solid var(--cta-main, #f97316); margin-bottom: 3rem; }
  .header-text { text-align: center; }
  .eyebrow { color: var(--cta-main, #f97316); font-weight: 700; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 0.1em; display: block; margin-bottom: 0.5rem; }
  h1 { font-size: clamp(2.5rem, 5vw, 4rem); margin: 0; line-height: 1; text-transform: uppercase; }
  .subtitle { color: #a0aec0; margin-top: 1rem; font-size: 1.1rem; }

  /* --- CARD PRINCIPAL (FEATURED) --- */
  .featured-card { display: grid; grid-template-columns: 1.2fr 1fr; background: white; border: 1px solid #e2e8f0; box-shadow: 8px 8px 0 var(--brand-800, #1a202c); margin-bottom: 3rem; overflow: hidden; transition: transform 0.2s; }
  .featured-card:hover { transform: translate(-2px, -2px); box-shadow: 10px 10px 0 var(--cta-main, #f97316); }
  .feat-image-wrap { position: relative; height: 100%; min-height: 400px; border-right: 1px solid #e2e8f0; }
  .feat-image-wrap img { width: 100%; height: 100%; object-fit: cover; }
  .category-tag { position: absolute; top: 1.5rem; left: 1.5rem; background: var(--cta-main, #f97316); color: #1a202c; padding: 0.5rem 1rem; font-weight: 700; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 0.05em; }
  .feat-content { padding: 3rem; display: flex; flex-direction: column; justify-content: center; }
  .date { color: #718096; font-weight: 600; margin-bottom: 1rem; display: block; }
  .feat-content h2 { font-size: 2.2rem; line-height: 1.1; margin: 0 0 1.5rem; color: #1a202c; }
  .feat-content p { color: #4a5568; font-size: 1.1rem; line-height: 1.6; margin-bottom: 2rem; }

  /* --- GRID SECUNDARIO --- */
  .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
  .news-card { background: white; border: 1px solid #e2e8f0; box-shadow: 6px 6px 0 #e2e8f0; display: flex; flex-direction: column; transition: transform 0.2s, box-shadow 0.2s; }
  .news-card:hover { transform: translateY(-4px); box-shadow: 8px 8px 0 var(--cta-main, #f97316); border-color: #1a202c; }
  .card-image-wrap { height: 220px; position: relative; border-bottom: 1px solid #e2e8f0; }
  .card-image-wrap img { width: 100%; height: 100%; object-fit: cover; }
  .category-tag-sm { position: absolute; bottom: 1rem; left: 1rem; background: #1a202c; color: white; padding: 0.3rem 0.8rem; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; }
  .card-content { padding: 1.5rem; flex: 1; display: flex; flex-direction: column; }
  .date-sm { font-size: 0.8rem; color: #a0aec0; margin-bottom: 0.5rem; }
  .card-content h3 { font-size: 1.25rem; margin: 0 0 1rem; line-height: 1.3; color: #1a202c; flex: 1; }

  /* --- BOTONES ENLACES --- */
  .read-btn { display: inline-block; background: var(--brand-800, #1a202c); color: white; padding: 1rem 2rem; font-weight: 700; text-transform: uppercase; text-decoration: none; align-self: flex-start; transition: background 0.2s; }
  .read-btn:hover { background: var(--cta-main, #f97316); color: #1a202c; }
  .read-link { font-weight: 700; text-transform: uppercase; color: #1a202c; text-decoration: none; border-bottom: 2px solid var(--cta-main, #f97316); align-self: flex-start; font-size: 0.9rem; padding-bottom: 2px; }
  .read-link:hover { color: var(--cta-main, #f97316); }

  /* --- ANIMACIONES DE ENTRADA LIGERAS --- */
  .fade-in { 
    opacity: 0; 
    animation: fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; 
  }
  .delay-1 { animation-delay: 0.15s; }
  .delay-2 { animation-delay: 0.3s; }
  .delay-3 { animation-delay: 0.45s; }

  @keyframes fadeIn { 
    from { 
      opacity: 0; 
      transform: translateY(20px); 
    } 
    to { 
      opacity: 1; 
      transform: translateY(0); 
    } 
  }

  /* --- RESPONSIVE --- */
  @media (max-width: 900px) {
    .featured-card { grid-template-columns: 1fr; }
    .feat-image-wrap { min-height: 250px; border-right: none; border-bottom: 1px solid #e2e8f0; }
    .feat-content { padding: 2rem; }
    .feat-content h2 { font-size: 1.8rem; }
  }
</style>