---
import { Image } from 'astro:assets';
import e2vLogo from '../assets/E2V.png';

interface NavItem {
  name: string;
  href: string;
  highlight?: boolean;
}

const navItems: NavItem[] = [
  { name: 'Inicio', href: '/' },
  { name: 'Quiénes somos', href: '/quienes-somos' },
  { name: 'Noticias', href: '/noticias' },
  { name: 'Contacto', href: '/contacto' },
  { name: '⚡ElectroPoint', href: '/', highlight: true }, // Resaltado
];
---

<header class="header">
  <div class="nav-container">
    <a href="/" class="logo">
      <Image src={e2vLogo} alt="E2V Logo" class="footer-logo" quality="high"/>
    </a>

    <nav id="menu" class="nav-links">
      <div class="links-wrapper">
        {navItems.map((item, index) => (
          <a 
            href={item.href} 
            class={item.highlight ? 'btn-highlight' : 'regular-link'} 
            style={`--i: ${index}`}
          >
            {item.name}
          </a>
        ))}
      </div>
    </nav>

    <button id="btn-toggle" class="btn-toggle" aria-label="Menú">
      <span></span><span></span><span></span>
    </button>
  </div>
</header>

<script>
  // Un solo script limpio para la funcionalidad del menú móvil y View Transitions
  function setupMenu() {
    const btn = document.getElementById('btn-toggle');
    const menu = document.getElementById('menu');

    if (btn && menu) {
      btn.onclick = null; // Limpiamos eventos previos
      
      btn.onclick = () => {
        const isShowing = menu.classList.toggle('show');
        btn.classList.toggle('open');
        document.body.style.overflow = isShowing ? 'hidden' : 'auto';
      };

      const links = menu.querySelectorAll('a');
      links.forEach(link => {
        link.onclick = () => {
          menu.classList.remove('show');
          btn.classList.remove('open');
          document.body.style.overflow = 'auto';
        };
      });
    }
  }

  setupMenu();
  document.addEventListener('astro:page-load', setupMenu);
</script>

<style>
  .header {
    background: var(--white);
    border-bottom: 2px solid var(--brand-200);
    position: sticky;
    top: 0;
    z-index: 9999;
    height: 80px;
    display: flex;
    align-items: center; /* Esto centra todo verticalmente en el header */
    font-family: var(--font-main);
  }

  .nav-container {
    display: flex;
    justify-content: space-between;
    align-items: center; /* Centra el logo y el menú verticalmente */
    width: 90%;
    max-width: 1200px;
    margin: auto;
    height: 100%;
  }

  /* Centramos la imagen del logo dentro de su etiqueta a */
  .logo { display: flex; align-items: center; height: 100%; }
  .logo img { height: 75px; width: auto; display: block; }

  /* SOLUCIÓN AL DESCUADRE VERTICAL: Aseguramos que los enlaces se alineen en su centro */
  .links-wrapper { 
    display: flex; 
    gap: 30px; 
    align-items: center; /* Clava todos los textos en el centro de la línea */
    height: 100%;
  }

  /* Estilo base de los links */
  .nav-links a {
    text-decoration: none;
    color: var(--brand-800);
    font-weight: 600;
    font-size: 14px;
    text-transform: uppercase;
    font-family: var(--font-main);
    transition: all 0.3s ease;
    display: flex; /* Ayuda a que el texto interno no salte */
    align-items: center;
  }

  .regular-link:hover {
    color: var(--cta-main);
  }

  /* BOTÓN ELECTROPOINT */
  .btn-highlight {
    background: var(--cta-main);
    color: var(--cta-dark) !important;
    padding: 10px 22px;
    border-radius: 4px; 
    box-shadow: 0 4px 0px var(--box-shadow);
    /* Al usar margin-bottom compensamos visualmente la sombra para que no empuje el resto de elementos hacia arriba */
    margin-bottom: 4px; 
  }

  .btn-highlight:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 0px var(--box-shadow);
    margin-bottom: 2px; /* Ajuste dinámico de compensación */
    background: var(--cta-main);
  }

  .btn-highlight:active {
    transform: translateY(2px);
    box-shadow: 0 0px 0px var(--box-shadow);
    margin-bottom: 6px; /* Ajuste dinámico de compensación */
  }

  .btn-toggle { display: none; }

  /* RESPONSIVE MÓVIL */
  @media (max-width: 1024px) {
    .btn-toggle { display: flex; flex-direction: column; gap: 6px; background: none; border: none; cursor: pointer; z-index: 10001; }
    .btn-toggle span { width: 28px; height: 3px; background: var(--brand-800); transition: 0.3s; }
    .btn-toggle.open span:nth-child(1) { transform: rotate(45deg) translate(6px, 6px); }
    .btn-toggle.open span:nth-child(2) { opacity: 0; }
    .btn-toggle.open span:nth-child(3) { transform: rotate(-45deg) translate(7px, -7px); }

    .nav-links {
      position: fixed;
      top: 0;
      right: -100%;
      width: 100%;
      height: 100vh;
      background: var(--white);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.4s ease-in-out;
      z-index: 10000;
    }

    .nav-links.show { right: 0; }
    .links-wrapper { flex-direction: column; gap: 2rem; justify-content: center; }
    
    .nav-links a { font-size: 20px; }
    
    /* Ajuste de botón en móvil */
    .btn-highlight {
      box-shadow: none;
      padding: 15px 40px;
      margin-bottom: 0; /* Quitamos la compensación en móvil porque es una lista vertical */
    }
    
    .btn-highlight:hover, .btn-highlight:active {
      transform: none;
      margin-bottom: 0;
    }
  }
</style>